Bootstrap: localimage
From: pmn-ptools.sif
%post
	# Install additional requirements for E2P2v5
	apt update
	apt install -y diamond-aligner
	# pip 24.0 crashes when trying to install tensorflow, so we'll downgrade to 23.x.x
	pip install -U 'pip<24.0.0'
	pip install keras pandas biopython scikit-learn tensorflow

	# Update the base pipeline, in case it's changed
	cd /pmn/creation-package
	git pull

	# Switch our local repository to the v5 branch
	cd /pmn/E2P2
	git switch v5

	# Install the deepec submodule
	git pull --recurse-submodules
	git submodule update --init --recursive

	# Put the v5 config file into the E2P2 directory so E2P2 can find it
	mv /pmn/creation-package/singularity/config.ini config.ini
