# Use this def file to create a PMN Singularity container with Pathway Tools installed
# Pathway Tools is proprietary software distributed by SRI International, and a license can be requested at http://bioinformatics.ai.sri.com/ptools/
# Please do not redistribute Singularity containers generated by this build script

Bootstrap: localimage
From: pmn.sif
%post
	apt install -y libssl-dev
	export PT_VER=27.0
	echo "export PT_VER=$PT_VER" >> $SINGULARITY_ENVIRONMENT
	export PT_INSTALLER=pathway-tools-$PT_VER-linux-64-tier1-install
	/pmn/$PT_INSTALLER --InstallDir /pmn/pathway-tools --PTOOLS_LOCAL_PATH /pmn --InstallDesktopShortcuts 0 --mode unattended
	mkdir /pgdbs
	rmdir /pmn/ptools-local/pgdbs/user
	ln -s /pgdbs /pmn/ptools-local/pgdbs/user
	echo; echo "Note: The container file generated by this build script contains an installed copy of Pathway Tools $PT_VER, which is proprietary software distributed by SRI International (http://bioinformatics.ai.sri.com/ptools). For this reason, please do not redistribute the container without permission from SRI International"; echo
%environment
%files
	pathway-tools-27.0-linux-64-tier1-install /pmn

%runscript
	$PMN_BIN/pmn-pipeline $*
